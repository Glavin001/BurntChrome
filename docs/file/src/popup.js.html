<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/popup.js | Burnt Chrome API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="git+https://github.com/Glavin001/BurntChrome.git">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/background.js~Moderator.html">Moderator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/background.js~Whitelist.html">Whitelist</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/popup.js~Popup.html">Popup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-whitelist">whitelist</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-whitelist_entry">whitelist_entry</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/popup.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
@desc Popup view for Burnt Chrome
*/
class Popup {
  /**
  @desc Initialize the instance.
  @private
  */
  constructor() {
    // Setup defaults
    /**
    Background page.
    */
    this.background = chrome.extension.getBackgroundPage();
    /**
    Template element ID
    */
    this.templateId = &apos;frame&apos;;

    //
    this.setupTemplates();

    // Render initial page
    this.refresh();
  }

  /**
  @desc Setup handlebars views to render compiled templates to.
  @private
  */
  setupTemplates() {
    let handlebarsSelector = &apos;script[type=&quot;text/x-handlebars-template&quot;]&apos;;
    $(handlebarsSelector).each((index, $el) =&gt; {
      // console.log($el, $el.id);
      var templateId = $el.id;
      if (!templateId) {
        return console.warn(&quot;Unknown id for element: &quot;, $el);
      }
      let containerId = templateId.split(&apos;-template&apos;)[0];
      $($el).after($(`&lt;div id=&quot;${containerId}&quot;&gt;&lt;/div&gt;`));
    });
  }

  /**
  @desc Generate the context to pass to the template to render.
  @private
  */
  getContext() {
    return {
      isLoggedIn: this.background.moderator.loggedIn,
      isLocked: this.background.moderator.isLocked(),
      isUnlocked: this.background.moderator.isUnlocked(),
      whitelist: this.background.moderator.getWhitelistJSON(),
      email: this.background.moderator.getEmail()
    };
  }

  /**
  @desc Render the template with a context
  @private
  */
  render(id, context) {
    console.log(&apos;render&apos;, context);
    let el = document.getElementById(`${id}-template`);
    let source = el.innerHTML;
    let template = Handlebars.compile(source);
    let html = template(context);
    document.getElementById(id).innerHTML = html;
    // console.log(&apos;html&apos;, html);
    // Bind events
    this.bind();
  }

  /**
  @desc Bind the events
  @private
  */
  bind() {
    // console.log(&apos;Bind element events&apos;);
    $(&apos;#lock&apos;).click(() =&gt; this.lock());
    $(&apos;#logout&apos;).click(() =&gt; this.logout());
    $(&apos;#unlock&apos;).click(() =&gt; this.unlock());
    $(&apos;#add-to-whitelist&apos;).click(() =&gt; this.addToWhitelist());
  }

  /**
  @desc Refresh the template
  @private
  */
  refresh() {
    this.render(this.templateId, this.getContext());
  }

  /**
  @desc Lock
  @public
  */
  lock() {
    // console.log(&apos;Lock!&apos;);
    let context = this.getContext();
    let email = $(&apos;input[name=&quot;email&quot;]&apos;).val() || context.email;
    let password = $(&apos;input[name=&quot;password&quot;]&apos;).val();
    // console.log(email, password);
    let successful = this.background.moderator.lock(email, password);
    console.log(&apos;successful&apos;, successful);
    this.refresh();
  }

  /**
  @desc Logout
  @public
  */
  logout() {
    // console.log(&apos;logout!&apos;);
    let successful = this.background.moderator.logout();
    // console.log(&apos;successful&apos;, successful);
    this.refresh();
  }

  /**
  @desc Unlock
  @public
  */
  unlock() {
    // console.log(&apos;Unlock!&apos;);
    let context = this.getContext();
    let email = $(&apos;input[name=&quot;email&quot;]&apos;).val() || context.email;
    let password = $(&apos;input[name=&quot;password&quot;]&apos;).val(); // || prompt(&apos;Please confirm that you want to unlock Chrome by entering your password&apos;);
    // console.log(email, password);
    if (email &amp;&amp; password) {
      let successful = this.background.moderator.unlock(email, password);
      // console.log(&apos;successful&apos;, successful);
      this.refresh();
    }
  }

  /**
  @desc Add to Whitelist
  @public
  */
  addToWhitelist() {
    // console.log(&apos;addToWhitelist&apos;);
    let title = $(&apos;input[name=&quot;entry-title&quot;]&apos;).val();
    let url = $(&apos;input[name=&quot;entry-url&quot;]&apos;).val();
    let successful = this.background.moderator.addToWhitelist(title, url);
    if (successful) this.refresh();
  }

};

/**
Ready up!

@ignore
*/
$(document).ready(() =&gt; {
  // console.log(&apos;Ready&apos;);
  let burnt = window.burnt = new Popup();

});</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
